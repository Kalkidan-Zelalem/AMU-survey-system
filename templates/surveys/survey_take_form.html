<!-- templates/surveys/survey_take_form.html -->
{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="content-section">
        <h2>{{ object.title }}</h2>
        <p class="lead">{{ object.description }}</p>
        <hr>
        
        <!-- === THIS IS THE FIX ON LINE 8 (the form's action) === -->
        <form method="POST" action="{% url 'surveys:survey-take' pk=object.pk %}">
            {% csrf_token %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Questions</legend>
                
                {% for question in object.questions.all %}
                    <div class="card mb-3">
                        <div class="card-header">
                            <strong>{{ forloop.counter }}. {{ question.text }}</strong>
                        </div>
                        <div class="card-body">
                            {% if question.question_type == 'TEXT' or question.question_type == 'TEXTAREA' %}
                                <input type="text" name="question_{{ question.id }}" class="form-control">
                            {% elif question.question_type == 'RATING' %}
                                <!-- Add a simple rating scale -->
                                {% for i in "12345" %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="q{{question.id}}_r{{i}}" value="{{ i }}">
                                    <label class="form-check-label" for="q{{question.id}}_r{{i}}">{{ i }}</label>
                                </div>
                                {% endfor %}
                            {% elif question.question_type == 'CHOICE' %}
                                {% for choice in question.choices.all %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question_{{ question.id }}" id="choice_{{ choice.id }}" value="{{ choice.id }}">
                                        <label class="form-check-label" for="choice_{{ choice.id }}">
                                            {{ choice.text }}
                                        </label>
                                    </div>
                                {% endfor %}
                            {% elif question.question_type == 'MULTICHOICE' %}
                                {% for choice in question.choices.all %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="question_{{ question.id }}" id="choice_{{ choice.id }}" value="{{ choice.id }}">
                                        <label class="form-check-label" for="choice_{{ choice.id }}">
                                            {{ choice.text }}
                                        </label>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </fieldset>
            <div class="form-group mt-4">
                <button class="btn btn-primary" type="submit">Submit My Response</button>
            </div>
        </form>
    </div>
{% endblock %}