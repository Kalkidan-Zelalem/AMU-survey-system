<!-- templates/surveys/survey_results.html -->
{% extends 'base.html' %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Results for: "{{ survey.title }}"</h1>
        
        <!-- === THIS IS THE FIX ON LINE 6 === -->
        <a href="{% url 'surveys:survey-detail' pk=survey.pk %}" class="btn btn-secondary">Â« Back to Manage Survey</a>
    </div>

    <p>Total Responses: {{ survey.responses.count }}</p>
    <hr>

    {% for response in survey.responses.all %}
        <div class="card mb-3">
            <div class="card-header">
                Response from <strong>{{ response.respondent.username }}</strong> on {{ response.submitted_at|date:"M d, Y, P" }}
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    {% for answer in response.answers.all %}
                        <li>
                            <p><strong>Q: {{ answer.question.text }}</strong></p>
                            {% if answer.question.question_type == 'CHOICE' or answer.question.question_type == 'MULTICHOICE' %}
                                <p>A: 
                                    {% for choice in answer.choices.all %}
                                        <span class="badge bg-primary">{{ choice.text }}</span>
                                    {% empty %}
                                        <em>(No choice selected)</em>
                                    {% endfor %}
                                </p>
                            {% else %}
                                <p class="ms-3">A: <em>{{ answer.body|default:"(Not answered)" }}</em></p>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% empty %}
        <div class="alert alert-info">There are no responses for this survey yet.</div>
    {% endfor %}
{% endblock %}